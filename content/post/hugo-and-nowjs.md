---
title: "Deploying a Hugo static site using Now.js"
date: 2018-08-06T22:28:47-07:00
---

# Deploying a Hugo static site using Now.js

Like most of you probably, the first thing I do when I want to do something is google it. To my surprise I wasn't able to find any step-by-step guide to making [now.js](https://zeit.co/now) and [hugo](https://gohugo.io/) play together. Granted it was pretty straight forward, but I like it better when someone else has done the work for me so it seems appropriate that as I work on setting up my new site I would share the process in the hopes that someone else might find it useful.

> <tl;dr> Example can be found here https://github.com/dremonkey/hugo-nowjs-example

## Setup

I'm not going to dive into the weeds here, just lay out the gist of what you need to do. For details please refer to the official docs: [Now setup](https://zeit.co/docs) and [Hugo quickstart](https://gohugo.io/getting-started/quick-start/)

### Setup Hugo

1. [Install Hugo](https://gohugo.io/getting-started/installing/)
2. Bootstrap your hugo site using `hugo new site my-new-site`
3. Add some content
4. Pick a theme from https://themes.gohugo.io/ - This is *optional* but what's the point if you can't personalize it? Also without a theme all you will see initially is a blank page.
5. Preview your new site `hugo server -D`. It should be running at `http://localhost:1313/`.

### Setup Now

1. [Signup for Now](https://zeit.co/signup)
2. Install the [Now desktop client and CLI tool](https://zeit.co/download)
3. [Connect to Github](https://zeit.co/github) - This is *optional* but recommended. By doing this every push to your repo will trigger a Now deployment which means that you don't have to worry about building and pushing your own images unless you want to.


## Tying Now and Hugo together

Once you have completed setup tying it all together only requires the creation of two additional files:

1. The `now.json` file which will be used to configure your Now deployment
2. The `Dockerfile` which will be used to build your site

> The full example repo can be found on github here: https://github.com/dremonkey/hugo-nowjs-example

### Now.json file

The `now.json` file is used to configure your Now deployment. In our case we are creating a static site so you need to tell Now that this is a static site. The `now.json` file should look like this:

```json
{
  "type": "static"
}
```

### Dockerfile

Creating the `Dockerfile` was probably the most difficult part of this whole process. It utilizes a [multi-stage build](https://docs.docker.com/develop/develop-images/multistage-build/) so that the final image contains **only** the `/public` files and nothing else. In addition to making the image size as small as it can possibly be, it also ensures that you don't accidentally expose any secrets that may be necessary to build your site.

> The latest version of Hugo at time of writing was 0.46

Also as mentioned previously it is important to remember that

> When using docker, Now expects your static files to be at `/public`

Here is the Dockerfile I came up with:

```Dockerfile
FROM alpine:3.7 as build

RUN apk --update add curl bash

ENV HUGO_VERSION 0.46
ENV HUGO_DL https://github.com/gohugoio/hugo/releases/download/v${HUGO_VERSION}/hugo_${HUGO_VERSION}_Linux-64bit.tar.gz
RUN curl -fsSL ${HUGO_DL} | tar xvz -C /usr/local/bin

COPY . /app
WORKDIR /app
RUN hugo

FROM scratch as deploy

# Copy only the public files over to the final image
COPY --from=build /app/public /public
```

## Deploying

To deploy your site to Now simply execute `now` from the command line. The important thing to note here is the autogenerated URL of your newly deployed site. In this particular example it is `https://hugo-nowjs-example-iqcogpxusc.now.sh`.

```
$ now

> Synced 1 file (269B) [867ms]
> https://hugo-nowjs-example-iqcogpxusc.now.sh [in clipboard] [2s]
> Building…
> Sending build context to Docker daemon  526.8kB
> Step 1/10 : FROM alpine:3.7 as build

...

> ▲ Uploading static files (240.0K)
> Build completed
> Success! Deployment ready
```
